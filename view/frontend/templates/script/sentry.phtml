<?php
// phpcs:disable Magento2.Templates.ThisInTemplate.FoundThis
/** @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer */
/** @var \JustBetter\Sentry\Block\SentryScript $block */
if (!$block->canUseScriptTag($block->getNameInLayout())) {
    return;
}

$bundleFile = 'bundle';

if ($block->isTracingEnabled()) {
    $bundleFile .= '.tracing';
}

if ($block->useSessionReplay()) {
    $bundleFile .= '.replay';
}

$bundleFile .= '.min.js';

$remoteFile = sprintf(
    'https://browser.sentry-cdn.com/%s/%s',
    $block->escapeHtmlAttr($block->getJsSdkVersion()),
    $bundleFile
);
?>

<?= $secureRenderer->renderTag('script', ['src' => $remoteFile, 'crossorigin' => 'anonymous']) ?>
<?= $secureRenderer->renderTag('script', [], $block->getLayout()->createBlock(\JustBetter\Sentry\Block\SentryScript::class)
    ->setTemplate('JustBetter_Sentry::script/sentry_init.phtml')
    ->toHtml()); ?>

<?php if ($block->useLogRocket()): ?>
    <?= $secureRenderer->renderTag('script', ['src' => 'https://cdn.lr-ingest.io/LogRocket.min.js', 'crossorigin' => 'anonymous']) ?>
    <?= $secureRenderer->renderTag('script', [],
        "window.LogRocket && window.LogRocket.init('" . /* @noEscape */ trim($block->getLogrocketKey()) . "');"
    ); ?>
    <?= $secureRenderer->renderTag('script', [],
       'LogRocket.getSessionURL(sessionURL => {
            Sentry.configureScope(scope => {
                scope.setExtra("sessionURL", sessionURL);
            });
        });'
    ); ?>
    <?= $secureRenderer->renderTag('script', [], $block->getLayout()->createBlock(\JustBetter\Sentry\Block\SentryScript::class)
        ->setTemplate('JustBetter_Sentry::script/logrocket_init.phtml')
        ->toHtml()); ?>
<?php endif; ?>
